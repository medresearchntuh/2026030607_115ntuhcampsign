<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>115年度臺大醫療體系研究營 - 簽到退系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --color-dark: #534a55;
            --color-primary: #5e4a6f;
            --color-accent: #d3b4d3;
            --color-light: #c8b7c9;
        }
        .bg-theme-primary { background-color: var(--color-primary); }
        .text-theme-primary { color: var(--color-primary); }
        .border-theme-primary { border-color: var(--color-primary); }
        .bg-theme-dark { background-color: var(--color-dark); }
        .text-theme-dark { color: var(--color-dark); }
        .bg-theme-accent { background-color: var(--color-accent); }
        .border-theme-accent { border-color: var(--color-accent); }
        .focus-ring-theme:focus { --tw-ring-color: var(--color-accent); border-color: var(--color-primary); }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8f6f8; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--color-primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Loading Overlay for Init */
        #init-loader { z-index: 100; }
        
        /* Live Records Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d3b4d3; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #5e4a6f; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Config Section (User Needs to Edit This) -->
    <script>
        // ==========================================
        // Google Apps Script 網址 (已更新)
        // ==========================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxdCEQvztvzPYqjRnsFB8biUxXe7e6NdMEqPFcrBvzPth-vnCn87Jin-E9iFFWFExiL9A/exec";
    </script>

    <!-- Header -->
    <header class="bg-theme-primary text-white py-4 px-4 shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 -mr-16 -mt-16 w-48 h-48 rounded-full bg-[#d3b4d3] opacity-20"></div>
        <div class="max-w-md mx-auto text-center relative z-10">
            <div class="mb-2 flex justify-center">
                <img src="https://i.meee.com.tw/AAiaMSR.png" alt="台大醫院 Logo" class="h-12 object-contain bg-white/10 rounded-lg p-1 backdrop-blur-sm">
            </div>
            <h1 class="text-lg font-bold mb-0.5 tracking-wide leading-tight">115年度臺大醫療體系</h1>
            <h2 class="text-base font-medium text-[#d3b4d3] mb-1 leading-tight">新進主治醫師與醫事人員研究營</h2>
            <div class="inline-block bg-white/10 px-3 py-0.5 rounded-full mb-2">
                <h3 class="text-sm font-bold text-white tracking-widest">參訓人員線上簽到退系統</h3>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 max-w-md mx-auto w-full relative">
        
        <!-- System Status Alert -->
        <div id="status-bar" class="hidden mb-4 p-3 rounded-lg text-sm flex items-center justify-center"></div>

        <!-- Card 1: Search -->
        <div id="search-section" class="bg-white rounded-xl shadow-md p-6 mb-6 fade-in border-t-4 border-theme-primary">
            <h3 class="text-theme-dark font-bold text-lg mb-4 flex items-center">
                <span class="w-1 h-6 bg-theme-primary mr-2 rounded-full"></span>
                人員識別
            </h3>
            <div class="space-y-4">
                <div>
                    <label for="employee-id" class="block text-sm font-medium text-gray-600 mb-1">請輸入員工編號 或 姓名</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="employee-id" 
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border focus:ring-2 focus-ring-theme p-3 shadow-sm transition outline-none disabled:bg-gray-100 disabled:text-gray-400" 
                            placeholder="請稍候，名冊讀取中..." disabled oninput="this.value = this.value.toUpperCase()">
                        
                        <button id="btn-search" onclick="lookupEmployee()" disabled
                            class="absolute inset-y-0 right-0 bg-gray-400 text-white px-5 rounded-r-lg transition flex items-center justify-center font-medium shadow-sm z-10 cursor-not-allowed">
                            查詢
                        </button>

                        <button id="btn-clear" onclick="resetForm()" 
                            class="hidden absolute inset-y-0 right-0 bg-red-500 text-white px-5 rounded-r-lg hover:bg-red-700 transition flex items-center justify-center font-medium shadow-sm z-20">
                            <i class="fas fa-times mr-2"></i>重填
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 ml-1">*輸入編號或姓名皆可查詢自動帶入資料</p>
                </div>
            </div>
        </div>

        <!-- Card 2: Profile -->
        <div id="profile-section" class="hidden bg-white rounded-xl shadow-md p-6 mb-6 fade-in border-t-4 border-[#d3b4d3] relative">
            <button onclick="resetForm()" class="absolute top-4 right-4 text-gray-400 hover:text-theme-primary transition" title="重新輸入">
                <i class="fas fa-times-circle text-xl"></i>
            </button>
            <h3 class="text-theme-dark font-bold text-lg mb-4 pl-1">確認基本資料</h3>
            <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                <div class="col-span-2 sm:col-span-1 bg-[#f8f6f8] p-3 rounded-lg">
                    <p class="text-gray-500 text-xs mb-1">姓名</p>
                    <p class="font-bold text-lg text-theme-dark" id="display-name">--</p>
                </div>
                <div class="col-span-2 sm:col-span-1 bg-[#f8f6f8] p-3 rounded-lg">
                    <p class="text-gray-500 text-xs mb-1">身分</p>
                    <span id="display-role" class="inline-block bg-[#d3b4d3]/30 text-theme-primary text-xs px-2 py-1 rounded-full font-bold">--</span>
                </div>
                <div class="p-2"><p class="text-gray-500 text-xs">院別</p><p class="font-medium text-theme-dark" id="display-hospital">--</p></div>
                <div class="p-2"><p class="text-gray-500 text-xs">科部別</p><p class="font-medium text-theme-dark" id="display-dept">--</p></div>
                <div class="col-span-2 p-2 border-t border-dashed border-gray-200"><p class="text-gray-500 text-xs">職稱</p><p class="font-medium text-theme-dark" id="display-title">--</p></div>
            </div>
            <!-- Check-in History -->
            <div id="history-container" class="hidden mt-4 pt-4 border-t-2 border-[#f8f6f8]">
                <h4 class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider"><i class="fas fa-history mr-1"></i> 暫存狀態 (本次瀏覽器)</h4>
                <div id="history-list" class="space-y-2"></div>
            </div>
        </div>

        <!-- Card 3: Action -->
        <div id="action-section" class="hidden bg-white rounded-xl shadow-md p-6 fade-in border-t-4 border-theme-primary">
            <h3 class="text-theme-dark font-bold text-lg mb-4 flex items-center">
                <span class="w-1 h-6 bg-theme-primary mr-2 rounded-full"></span>
                簽到退紀錄
            </h3>
            <form id="checkin-form" onsubmit="handleFormSubmit(event)">
                <div class="mb-5">
                    <label class="block text-sm font-medium text-gray-700 mb-2">選擇日期</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer group">
                            <input type="radio" name="event_date" value="2026-03-06" class="peer sr-only" checked onchange="updateTime()">
                            <div class="rounded-lg border-2 border-gray-200 p-3 text-center peer-checked:border-theme-primary peer-checked:bg-[#f8f6f8] group-hover:bg-gray-50 transition relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-3 h-3 bg-theme-primary rounded-bl-lg opacity-0 peer-checked:opacity-100 transition"></div>
                                <div class="text-xs text-gray-500">Day 1</div>
                                <div class="font-bold text-theme-dark">3月6日 (五)</div>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" name="event_date" value="2026-03-07" class="peer sr-only" onchange="updateTime()">
                            <div class="rounded-lg border-2 border-gray-200 p-3 text-center peer-checked:border-theme-primary peer-checked:bg-[#f8f6f8] group-hover:bg-gray-50 transition relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-3 h-3 bg-theme-primary rounded-bl-lg opacity-0 peer-checked:opacity-100 transition"></div>
                                <div class="text-xs text-gray-500">Day 2</div>
                                <div class="font-bold text-theme-dark">3月7日 (六)</div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="mb-5">
                    <label class="block text-sm font-medium text-gray-700 mb-2">簽到類型</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="check_type" value="checkin" class="peer sr-only" checked>
                            <div class="flex flex-col items-center justify-center rounded-lg border-2 border-gray-200 p-3 peer-checked:border-theme-primary peer-checked:bg-[#d3b4d3]/20 peer-checked:text-theme-primary hover:bg-gray-50 transition h-full">
                                <i class="fas fa-sign-in-alt mb-1 text-xl"></i><span class="font-bold text-sm">活動報到</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="check_type" value="checkout" class="peer sr-only">
                            <div class="flex flex-col items-center justify-center rounded-lg border-2 border-gray-200 p-3 peer-checked:border-theme-dark peer-checked:bg-gray-100 peer-checked:text-theme-dark hover:bg-gray-50 transition h-full">
                                <i class="fas fa-sign-out-alt mb-1 text-xl"></i><span class="font-bold text-sm">活動簽退</span>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="mb-5 bg-red-50 border-l-4 border-red-400 p-3 rounded-r text-sm">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-circle text-red-500 mt-0.5 mr-2"></i>
                        <div class="text-gray-700 text-xs leading-relaxed">
                            <p class="font-bold text-red-700 mb-1">請勿重複簽到退與代簽</p>
                            <p>如提早離開也請簽退，本部將會以此計算公假補休時數。</p>
                        </div>
                    </div>
                </div>
                <div class="mb-6 bg-[#534a55] text-white p-3 rounded-lg flex justify-between items-center shadow-inner">
                    <span class="text-xs opacity-80">當前時間</span>
                    <span id="current-time" class="font-mono font-bold text-lg tracking-wider">--:--</span>
                </div>
                
                <input type="hidden" id="form-name" name="name">
                <input type="hidden" id="form-id" name="employee_id">
                <input type="hidden" id="form-dept" name="department">
                <input type="hidden" id="form-title" name="job_title">
                
                <button type="submit" id="submit-btn" class="w-full bg-theme-primary text-white font-bold py-3.5 rounded-lg shadow-lg hover:bg-[#534a55] focus:outline-none focus:ring-2 focus:ring-[#d3b4d3] focus:ring-offset-2 transition transform active:scale-[0.98]">
                    確認送出紀錄
                </button>
            </form>
        </div>

        <!-- NEW: Live Records Section -->
        <div id="live-records-section" class="bg-white rounded-xl shadow-md p-6 mb-6 fade-in border-t-4 border-gray-400">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-theme-dark font-bold text-lg flex items-center">
                    <span class="w-1 h-6 bg-gray-400 mr-2 rounded-full"></span>
                    即時簽到狀況 (最近30筆)
                </h3>
                <button onclick="fetchLiveRecords()" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded transition">
                    <i class="fas fa-sync-alt mr-1"></i>更新
                </button>
            </div>
            
            <div class="overflow-y-auto max-h-64 custom-scrollbar rounded border border-gray-100 bg-gray-50 p-2">
                <div id="live-list-content" class="space-y-2">
                    <div class="text-center text-gray-400 py-4 text-xs">
                        <i class="fas fa-spinner fa-spin mr-1"></i> 正在載入資料...
                    </div>
                </div>
            </div>
            <p class="text-right text-[10px] text-gray-400 mt-2">*系統每30秒自動更新</p>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-[#534a55] text-gray-300 py-4 text-center text-xs">
        <div class="max-w-md mx-auto px-4"><p>承辦單位與系統設計：台大醫院總院醫學研究部 陳巧瑜管理師 (分機 263254)</p></div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-[#534a55] bg-opacity-80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white p-6 rounded-xl shadow-2xl text-center max-w-sm w-full mx-4 border border-[#d3b4d3]">
            <div class="flex justify-center mb-4"><div class="loader"></div></div>
            <h3 class="text-lg font-bold text-theme-dark" id="loading-text">資料處理中...</h3>
            <p class="text-sm text-gray-500 mt-2">請稍候。</p>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-[#534a55] bg-opacity-90 hidden flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full mx-4 transform scale-100 transition-all border-t-8 border-theme-primary">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-[#d3b4d3]/30 mb-4"><i class="fas fa-check text-theme-primary text-3xl"></i></div>
            <h3 class="text-2xl font-bold text-theme-dark mb-2">簽到成功!</h3>
            <p class="text-gray-500 mb-6 text-sm">資料已寫入系統。</p>
            <a href="https://linktr.ee/ntuhmed" class="block w-full bg-theme-primary text-white font-bold py-3 rounded-lg hover:bg-[#534a55] transition shadow-md">返回活動網頁</a>
        </div>
    </div>

    <script>
        let participantData = [];
        const STORAGE_KEY = 'ntuh_camp_115_local_history';

        // 1. Initialize: Fetch Data from Google Sheet
        window.addEventListener('load', async () => {
            const inputField = document.getElementById('employee-id');
            const searchBtn = document.getElementById('btn-search');
            
            // Check if user set the URL
            if (!SCRIPT_URL || SCRIPT_URL.includes("您的_GOOGLE")) {
                alert("系統未設定：請先編輯 index.html 填入 Apps Script 網址");
                return;
            }

            try {
                // Show subtle loading state in placeholder
                inputField.placeholder = "正在從雲端讀取名冊...";
                
                // Fetch Roster (Default)
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();

                if (data.status === 'error') {
                    throw new Error(data.message);
                }

                participantData = data;
                
                // Enable Input
                inputField.disabled = false;
                inputField.placeholder = "例如: 002904 或 王小明";
                searchBtn.disabled = false;
                searchBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                searchBtn.classList.add('bg-theme-primary', 'hover:bg-[#534a55]');
                
                console.log(`Loaded ${participantData.length} participants.`);

                // Start fetching live records
                fetchLiveRecords();
                setInterval(fetchLiveRecords, 30000); // Poll every 30s

            } catch (error) {
                console.error("Fetch Error:", error);
                inputField.placeholder = "讀取失敗，請重新整理頁面";
                alert("無法讀取名冊，請檢查網路或聯繫管理員。\n錯誤: " + error.message);
            }
        });

        // Live Records Fetcher
        async function fetchLiveRecords() {
            const listContainer = document.getElementById('live-list-content');
            try {
                // Using the specific action parameter
                const response = await fetch(`${SCRIPT_URL}?action=get_records`);
                const records = await response.json();

                if (!Array.isArray(records)) {
                    // Fallback if backend is not updated yet
                    listContainer.innerHTML = `<div class="text-center text-gray-400 py-2 text-xs">需更新後端程式碼才能顯示</div>`;
                    return;
                }

                if (records.length === 0) {
                    listContainer.innerHTML = `<div class="text-center text-gray-400 py-2 text-xs">目前尚無簽到紀錄</div>`;
                    return;
                }

                listContainer.innerHTML = '';
                records.forEach(r => {
                    const isCheckIn = r.type === "活動報到";
                    const colorClass = isCheckIn ? "text-green-700 bg-green-50 border-green-200" : "text-orange-700 bg-orange-50 border-orange-200";
                    const icon = isCheckIn ? "fa-sign-in-alt" : "fa-sign-out-alt";
                    
                    const html = `
                        <div class="flex justify-between items-center p-2 rounded border border-gray-200 bg-white text-sm shadow-sm">
                            <div class="flex items-center gap-2">
                                <span class="font-mono text-xs font-bold text-gray-500 bg-gray-100 px-1.5 rounded">${r.time}</span>
                                <span class="font-bold text-gray-700">${r.name}</span>
                            </div>
                            <span class="text-xs px-2 py-0.5 rounded-full border ${colorClass} flex items-center">
                                <i class="fas ${icon} mr-1"></i>${r.type}
                            </span>
                        </div>
                    `;
                    listContainer.innerHTML += html;
                });

            } catch (e) {
                console.error("Live records error:", e);
                // Don't alert user to avoid annoyance, just log
            }
        }

        // 2. Local Storage History Logic (Visual Feedback only)
        function getStoredRecords() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        function saveLocalHistory(id, record) {
            const allRecords = getStoredRecords();
            if (!allRecords[id]) allRecords[id] = [];
            allRecords[id].push(record);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allRecords));
        }

        // 3. Main Logic Functions
        function lookupEmployee() {
            const inputVal = document.getElementById('employee-id').value.trim();
            if (!inputVal) { alert("請輸入員工編號或姓名"); return; }

            const person = participantData.find(p => p.id === inputVal || p.name === inputVal);

            if (person) {
                document.getElementById('display-name').textContent = person.name;
                document.getElementById('display-role').textContent = person.role;
                document.getElementById('display-hospital').textContent = person.hospital;
                document.getElementById('display-dept').textContent = person.dept;
                document.getElementById('display-title').textContent = person.title;

                document.getElementById('form-name').value = person.name;
                document.getElementById('form-id').value = person.id;
                document.getElementById('form-dept').value = person.dept;
                document.getElementById('form-title').value = person.title;

                document.getElementById('profile-section').classList.remove('hidden');
                document.getElementById('action-section').classList.remove('hidden');
                
                document.getElementById('btn-search').classList.add('hidden');
                document.getElementById('btn-clear').classList.remove('hidden');
                document.getElementById('employee-id').disabled = true;

                renderHistory(person.id);
                document.getElementById('profile-section').scrollIntoView({ behavior: 'smooth' });
                updateTime();
            } else {
                alert("找不到此資料，請確認輸入正確的編號或姓名。");
                resetForm();
            }
        }

        function renderHistory(id) {
            const allRecords = getStoredRecords();
            const userRecords = allRecords[id] || [];
            const historyContainer = document.getElementById('history-container');
            const historyList = document.getElementById('history-list');

            historyList.innerHTML = ''; 
            if (userRecords.length > 0) {
                historyContainer.classList.remove('hidden');
                userRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                userRecords.forEach(record => {
                    const typeColor = record.type === 'checkin' ? 'text-green-600' : 'text-orange-600';
                    const typeText = record.type === 'checkin' ? '活動報到' : '活動簽退';
                    const icon = record.type === 'checkin' ? 'fa-sign-in-alt' : 'fa-sign-out-alt';
                    const dateObj = new Date(record.eventDate);
                    const dateStr = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;

                    const itemHtml = `
                        <div class="flex justify-between items-center bg-gray-50 p-2 rounded border border-gray-100 text-sm">
                            <div class="flex items-center">
                                <span class="font-bold text-gray-500 mr-2 w-10">${dateStr}</span>
                                <span class="${typeColor} font-bold flex items-center"><i class="fas ${icon} mr-1.5 text-xs"></i>${typeText}</span>
                            </div>
                            <span class="font-mono text-gray-600 text-xs bg-white px-1.5 py-0.5 rounded border border-gray-200">${record.timeStr}</span>
                        </div>`;
                    historyList.innerHTML += itemHtml;
                });
            } else {
                historyContainer.classList.add('hidden');
            }
        }

        function resetForm() {
            const input = document.getElementById('employee-id');
            input.value = "";
            input.disabled = false;
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('action-section').classList.add('hidden');
            document.getElementById('history-container').classList.add('hidden');
            document.getElementById('btn-search').classList.remove('hidden');
            document.getElementById('btn-clear').classList.add('hidden');
            input.focus();
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            
            // UI Loading
            const loadingOverlay = document.getElementById('loading-overlay');
            const submitBtn = document.getElementById('submit-btn');
            document.getElementById('loading-text').textContent = "正在寫入雲端資料庫...";
            loadingOverlay.classList.remove('hidden');
            submitBtn.disabled = true;

            const formData = new FormData(event.target);
            const id = formData.get('employee_id');
            const checkType = formData.get('check_type');
            const eventDate = formData.get('event_date');
            const name = formData.get('name');
            
            // Payload for Google Sheet
            const payload = {
                employee_id: id,
                name: name,
                check_type: checkType,
                event_date: eventDate,
                department: formData.get('department'),
                job_title: formData.get('job_title')
            };

            try {
                // Use fetch with 'no-cors' mode is TRICKY. 
                // Best practice for GAS Web App is using text/plain body to avoid CORS Preflight failure.
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();

                if (result.status === 'success') {
                    // Save local history for UX
                    const now = new Date();
                    saveLocalHistory(id, {
                        type: checkType,
                        eventDate: eventDate,
                        timestamp: now.toISOString(),
                        timeStr: now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false })
                    });

                    // Refresh Live List immediately
                    fetchLiveRecords();

                    // Success UI
                    loadingOverlay.classList.add('hidden');
                    document.getElementById('success-modal').classList.remove('hidden');
                    
                    // Removed auto-redirect logic
                } else {
                    throw new Error(result.message || "Unknown error");
                }

            } catch (error) {
                console.error(error);
                loadingOverlay.classList.add('hidden');
                submitBtn.disabled = false;
                alert("連線失敗，請檢查網路狀況。\n如果持續發生，請截圖聯繫承辦人員。\n錯誤訊息: " + error.message);
            }
        }

        setInterval(updateTime, 60000);
        updateTime();
        document.getElementById('employee-id').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') lookupEmployee();
        });
    </script>
</body>
</html>
